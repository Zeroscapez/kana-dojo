name: Auto-Reply to Issue Comments

on:
  issue_comment:
    types: [created]

permissions:
  issues: write

jobs:
  auto-respond:
    # Only run on issues (not PRs) with the 'community' label
    if: ${{ !github.event.issue.pull_request && contains(github.event.issue.labels.*.name, 'community') && github.event.comment.user.login != 'github-actions[bot]' }}

    runs-on: ubuntu-latest

    steps:
      - name: Check and respond to commenter
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issue = context.payload.issue;
            const commenter = context.payload.comment.user.login;

            // Check if issue is already assigned
            if (issue.assignees && issue.assignees.length > 0) {
              const assignee = issue.assignees[0].login;
              
              // If the commenter is not the assignee, let them know it's taken
              if (assignee !== commenter) {
                await github.rest.issues.createComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: issue.number,
                  body: 'Hey @' + commenter + '! ğŸ‘‹\n\n' +
                    'Thanks for your interest! Unfortunately, this issue is already assigned to @' + assignee + '.\n\n' +
                    'Don\'t worryâ€”we have new contribution opportunities posted every hour! Keep an eye on our [issues list](../../issues?q=is%3Aopen+is%3Aissue+label%3Acommunity) for the next one.\n\n' +
                    'ãŒã‚“ã°ã£ã¦! ğŸ’ª'
                });
              }
              return;
            }

            // Assign the commenter to the issue
            await github.rest.issues.addAssignees({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              assignees: [commenter]
            });

            // Post welcome message
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              body: 'Hey @' + commenter + '! ğŸ‘‹\n\n' +
                'Thanks for claiming this issue! You\'ve been assigned. ğŸ‰\n\n' +
                '**Next steps:**\n' +
                '1. Fork this repository\n' +
                '2. Make the changes described above\n' +
                '3. Submit a Pull Request linking to this issue (use `Closes #' + issue.number + '`)\n' +
                '4. Wait for review!\n\n' +
                '**Helpful resources:**\n' +
                '- [Contributing Guide](../../blob/main/CONTRIBUTING.md)\n' +
                '- [Code of Conduct](../../blob/main/CODE_OF_CONDUCT.md)\n\n' +
                'Need help? Just comment here and we\'ll assist you!\n\n' +
                'é ‘å¼µã£ã¦! ğŸ€'
            });

            console.log('Assigned issue #' + issue.number + ' to @' + commenter);
